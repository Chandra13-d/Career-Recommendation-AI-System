

{% extends "base.html" %}
{% block content %}

<!-- HERO -->
<section class="dash-hero text-center py-5">
    <div class="container">
        <h1 class="fw-bold">Dashboard Analytics</h1>
        <p class="dash-sub">View your AI-powered career recommendations and history.</p>
    </div>
</section>

<!-- MAIN CONTENT -->
<section class="container mt-5">

    <div class="analytics-card p-4 mx-auto">
        <h3 class="fw-bold text-primary mb-3">
            <i class="bi bi-bar-chart-fill"></i> Your Saved Predictions
        </h3>

        <div id="predTable" class="mt-3 text-center">
            <div class="loading-spinner"></div>
            <p class="mt-2 text-muted">Loading predictions...</p>
        </div>
    </div>

</section>

<!-- JS FOR API -->
<script>
async function loadPreds(){
  const uid = {{ session.get('user_id') or 'null' }};

  const wrap = document.getElementById("predTable");

  if (!uid) {
    wrap.innerHTML = "<p class='text-danger'>Login to see predictions.</p>";
    return;
  }

  const r = await fetch(`/api/user/${uid}/predictions`);
  if (!r.ok) {
    wrap.innerHTML = "<p class='text-danger'>Failed to load data.</p>";
    return;
  }

  const data = await r.json();
  if (!data.length) {
    wrap.innerHTML = "<p class='text-muted'>You have no saved predictions yet.</p>";
    return;
  }

  let html = `
    <div class="table-responsive">
      <table class="table modern-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Predicted Role</th>
            <th>Top 3 Roles</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody>
  `;

  data.forEach((p,i)=>{
    html += `
      <tr>
        <td>${i+1}</td>
        <td><span class="badge rounded-pill bg-primary">${p.predicted_role}</span></td>
        <td>${(p.top3||[]).map(t=> `<span class='badge bg-info text-dark me-1'>${t.label}</span>`).join("")}</td>
        <td>${new Date(p.created_at).toLocaleString()}</td>
      </tr>
    `;
  });

  html += "</tbody></table></div>";
  wrap.innerHTML = html;
}

loadPreds();
</script>

<!-- DASHBOARD STYLES -->
<style>

/* Hero Section */
.dash-hero {
    background: linear-gradient(135deg, #4c8bf5, #00c6a7);
    color: white;
    border-radius: 14px;
}
.dash-sub {
    opacity: 0.9;
    font-size: 1.1rem;
}

/* Main Card */
.analytics-card {
    max-width: 900px;
    background: #ffffff;
    border-radius: 18px;
    border: 1px solid #e8eef5;
    box-shadow: 0 10px 35px rgba(0,0,0,0.08);
}

/* Table Styling */
.modern-table thead {
    background: #f1f6ff;
}
.modern-table th {
    font-weight: 600;
    color: #2463eb;
}
.modern-table td {
    padding: 14px 10px;
}

/* Loading Spinner */
.loading-spinner {
    width: 40px;
    height: 40px;
    border: 5px solid #d9e7ff;
    border-top-color: #4c8bf5;
    border-radius: 50%;
    margin: auto;
    animation: spin 0.9s linear infinite;
}
@keyframes spin {
    to { transform: rotate(360deg); }
}

</style>

{% endblock %}



